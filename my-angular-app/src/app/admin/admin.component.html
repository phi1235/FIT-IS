<div class="admin-container">
  <!-- Main Content -->
  <main class="admin-main">
    <!-- Stats Grid -->
    <div class="dashboard-header">
      <h2>Dashboard Overview</h2>
      <div class="header-actions">
        <button class="btn-refresh" (click)="loadData()" [disabled]="loading">
          ğŸ”„ LÃ m má»›i dá»¯ liá»‡u
        </button>
      </div>
    </div>

    <!-- User Stats -->
    <div *ngIf="isAdmin">
      <h3 class="stats-title">Quáº£n lÃ½ NgÆ°á»i dÃ¹ng</h3>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon u-icon">ğŸ‘¥</div>
          <div class="stat-info">
            <div class="stat-value">{{ totalUsers }}</div>
            <div class="stat-label">Tá»•ng sá»‘ Users</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon u-icon">ğŸ‘‘</div>
          <div class="stat-info">
            <div class="stat-value">{{ adminCount }}</div>
            <div class="stat-label">Admin</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon u-icon">âœ…</div>
          <div class="stat-info">
            <div class="stat-value">{{ activeCount }}</div>
            <div class="stat-label">Äang hoáº¡t Ä‘á»™ng</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Ticket Stats -->
    <h3 class="stats-title">Quáº£n lÃ½ Tickets</h3>
    <div class="stats-grid">
      <div class="stat-card t-total">
        <div class="stat-icon t-icon">ğŸ«</div>
        <div class="stat-info">
          <div class="stat-value">{{ totalTickets }}</div>
          <div class="stat-label">Tá»•ng sá»‘ Tickets</div>
        </div>
      </div>
      <div class="stat-card t-pending">
        <div class="stat-icon t-icon">â³</div>
        <div class="stat-info">
          <div class="stat-value">{{ pendingTickets }}</div>
          <div class="stat-label">Chá» phÃª duyá»‡t</div>
        </div>
      </div>
      <div class="stat-card t-approved">
        <div class="stat-icon t-icon">âœ”ï¸</div>
        <div class="stat-info">
          <div class="stat-value">{{ approvedTickets }}</div>
          <div class="stat-label">ÄÃ£ phÃª duyá»‡t</div>
        </div>
      </div>
      <div class="stat-card t-rejected">
        <div class="stat-icon t-icon">âŒ</div>
        <div class="stat-info">
          <div class="stat-value">{{ rejectedTickets }}</div>
          <div class="stat-label">ÄÃ£ tá»« chá»‘i</div>
        </div>
      </div>
    </div>

    <!-- Quick Reports Section -->
    <div class="reports-section mb-4">
      <h3 class="stats-title">BÃ¡o cÃ¡o Nhanh</h3>
      <div class="reports-grid">
        <div class="report-card" *ngIf="isAdmin">
          <h4>BÃ¡o cÃ¡o Users</h4>
          <div class="report-actions">
            <button class="btn-report pdf" (click)="downloadReport('users', 'pdf')">PDF</button>
            <button class="btn-report excel" (click)="downloadReport('users', 'xlsx')">Excel</button>
          </div>
        </div>
        <div class="report-card">
          <h4>BÃ¡o cÃ¡o Tickets</h4>
          <div class="report-actions">
            <button class="btn-report pdf" (click)="downloadReport('tickets', 'pdf')">PDF</button>
            <button class="btn-report excel" (click)="downloadReport('tickets', 'xlsx')">Excel</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Users Table -->
    <div class="users-section mt-4" *ngIf="isAdmin">
      <div class="section-header">
        <h2>Danh SÃ¡ch Users</h2>
      </div>

      <!-- Error Message -->
      <div *ngIf="error" class="error-message">
        âš ï¸ {{ error }}
      </div>

      <!-- Loading -->
      <div *ngIf="loading" class="loading">
        <div class="spinner"></div>
        <span>Äang táº£i...</span>
      </div>

      <!-- Users Table -->
      <div *ngIf="!loading" class="table-container">
        <table class="users-table">
          <thead>
            <tr>
              <th>Username</th>
              <th>Email</th>
              <th>Há» TÃªn</th>
              <th>Role</th>
              <th>Tráº¡ng thÃ¡i</th>
              <th>Thao tÃ¡c</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of users" [class.disabled]="!user.enabled">
              <td>
                <strong>{{ user.username }}</strong>
              </td>
              <td>{{ user.email }}</td>
              <td>{{ (user.firstName || '') + ' ' + (user.lastName || '') }}</td>
              <td>
                <span class="badge" [class.badge-admin]="user.role === 'admin'"
                  [class.badge-user]="user.role === 'user'">
                  {{ user.role === 'admin' ? 'ğŸ‘‘ Admin' : 'ğŸ‘¤ User' }}
                </span>
              </td>
              <td>
                <span class="status" [class.status-active]="user.enabled" [class.status-inactive]="!user.enabled">
                  {{ user.enabled ? 'âœ… Hoáº¡t Ä‘á»™ng' : 'âŒ VÃ´ hiá»‡u hÃ³a' }}
                </span>
              </td>
              <td>
                <button class="btn-action" (click)="openRoleModal(user)">
                  âœï¸ Äá»•i Role
                </button>
              </td>
            </tr>
            <tr *ngIf="users.length === 0">
              <td colspan="6" class="no-data">KhÃ´ng cÃ³ dá»¯ liá»‡u</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <!-- Role Update Modal -->
  <div *ngIf="showRoleModal" class="modal-overlay" (click)="closeRoleModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Äá»•i Role cho User</h3>
        <button class="btn-close" (click)="closeRoleModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Username:</label>
          <input type="text" [value]="selectedUser?.username" readonly class="form-control">
        </div>
        <div class="form-group">
          <label>Role má»›i:</label>
          <select [(ngModel)]="newRole" class="form-control">
            <option value="user">ğŸ‘¤ User</option>
            <option value="maker">âœï¸ Maker</option>
            <option value="checker">ğŸ” Checker</option>
            <option value="admin">ğŸ‘‘ Admin</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" (click)="closeRoleModal()">Há»§y</button>
        <button class="btn-save" (click)="updateUserRole()" [disabled]="loading">
          {{ loading ? 'Äang lÆ°u...' : 'LÆ°u' }}
        </button>
      </div>
    </div>
  </div>
</div>