<div class="ticket-list-container">
    <div class="page-header">
        <div>
            <h1>üìã {{ isAdminView() ? 'Qu·∫£n l√Ω Tickets' : 'Y√™u c·∫ßu c·ªßa t√¥i' }}</h1>
            <p>{{ isAdminView() ? 'Theo d√µi v√† x·ª≠ l√Ω c√°c y√™u c·∫ßu nghi·ªáp v·ª•' : 'Danh s√°ch c√°c y√™u c·∫ßu b·∫°n ƒë√£ g·ª≠i h·ªá
                th·ªëng' }}</p>
        </div>
        <div class="header-actions">
            <div class="export-buttons" *ngIf="isAdminView()">
                <button class="btn-export pdf" (click)="downloadReport('pdf')" [disabled]="exporting" title="Xu·∫•t PDF">
                    PDF
                </button>
                <button class="btn-export excel" (click)="downloadReport('xlsx')" [disabled]="exporting"
                    title="Xu·∫•t Excel">
                    Excel
                </button>
            </div>
            <a *ngIf="canCreate()" routerLink="create" class="btn-create">
                <span>+</span> T·∫°o m·ªõi Ticket
            </a>
            <button class="btn-refresh" (click)="loadTickets()" [disabled]="loading">
                L√†m m·ªõi
            </button>
        </div>
    </div>

    <!-- Search Box -->
    <div class="search-box">
        <input type="text" placeholder="T√¨m ki·∫øm theo ti√™u ƒë·ªÅ, ng∆∞·ªùi t·∫°o..." [value]="searchQuery"
            (input)="onSearch($event)" class="search-input" />
        <span class="search-info">T·ªïng: {{ totalElements }} tickets</span>
    </div>

    <!-- Export Message with Progress Bar -->
    <div *ngIf="exportMessage" class="export-message" [class.exporting]="exporting">
        <div class="export-text">{{ exportMessage }}</div>
        <div *ngIf="exporting && exportProgress > 0" class="progress-bar-container">
            <div class="progress-bar" [style.width.%]="exportProgress"></div>
        </div>
    </div>

    <!-- Error Message -->
    <div *ngIf="exportError" class="error-message">
        {{ exportError }}
    </div>

    <!-- Loading -->
    <div *ngIf="loading" class="loading">
        <div class="spinner"></div>
        <span>ƒêang t·∫£i...</span>
    </div>

    <!-- Tickets Table -->
    <div *ngIf="!loading" class="table-container">
        <!-- Status Tabs -->
        <div class="status-tabs">
            <button class="status-tab" [class.active]="selectedStatus === 'ALL'" (click)="filterStatus('ALL')">T·∫•t
                c·∫£</button>
            <button class="status-tab" [class.active]="selectedStatus === 'DRAFT'" (click)="filterStatus('DRAFT')">B·∫£n
                nh√°p</button>
            <button class="status-tab" [class.active]="selectedStatus === 'SUBMITTED'"
                (click)="filterStatus('SUBMITTED')">Ch·ªù duy·ªát</button>
            <button class="status-tab" [class.active]="selectedStatus === 'APPROVED'"
                (click)="filterStatus('APPROVED')">ƒê√£ duy·ªát</button>
            <button class="status-tab" [class.active]="selectedStatus === 'REJECTED'"
                (click)="filterStatus('REJECTED')">B·ªã t·ª´ ch·ªëi</button>
        </div>

        <table class="tickets-table">
            <thead>
                <tr>
                    <th>M√£ ID</th>
                    <th>Ti√™u ƒë·ªÅ</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>S·ªë ti·ªÅn</th>
                    <th>Ng∆∞·ªùi t·∫°o</th>
                    <th>Ng√†y t·∫°o</th>
                    <th>Thao t√°c</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let ticket of filteredTickets">
                    <td><span class="ticket-id">#{{ ticket.id }}</span></td>
                    <td>
                        <div class="ticket-title">{{ ticket.title }}</div>
                    </td>
                    <td>
                        <span [class]="getStatusClass(ticket.status)">{{ getStatusLabel(ticket.status) }}</span>
                    </td>
                    <td>{{ ticket.amount | currency:'VND':'symbol':'1.0-0' }}</td>
                    <td>
                        <span class="avatar-sm">{{ ticket.maker.charAt(0).toUpperCase() }}</span>
                        {{ ticket.maker }}
                    </td>
                    <td>{{ ticket.createdAt | date:'dd/MM/yyyy HH:mm' }}</td>
                    <td>
                        <a [routerLink]="[ticket.id]" class="btn-detail">Chi ti·∫øt</a>
                    </td>
                </tr>
                <tr *ngIf="filteredTickets.length === 0">
                    <td colspan="7" class="no-data">
                        <div class="no-data-icon">üìÇ</div>
                        Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu ticket n√†o
                    </td>
                </tr>
            </tbody>
        </table>

        <!-- Pagination Controls -->
        <div class="pagination-controls" *ngIf="totalPages > 0">
            <div class="pagination-info">
                Hi·ªÉn th·ªã {{ currentPage * pageSize + 1 }} - {{ (currentPage + 1) * pageSize > totalElements ?
                totalElements : (currentPage + 1) * pageSize }}
                trong t·ªïng s·ªë {{ totalElements }} tickets
            </div>

            <div class="pagination-nav">
                <button class="btn-page" (click)="goToPage(0)" [disabled]="currentPage === 0"
                    title="Trang ƒë·∫ßu">‚èÆ</button>
                <button class="btn-page" (click)="previousPage()" [disabled]="currentPage === 0"
                    title="Trang tr∆∞·ªõc">‚óÄ</button>

                <button *ngFor="let page of getPageNumbers()" class="btn-page" [class.active]="page === currentPage"
                    (click)="goToPage(page)">
                    {{ page + 1 }}
                </button>

                <button class="btn-page" (click)="nextPage()" [disabled]="currentPage >= totalPages - 1"
                    title="Trang sau">‚ñ∂</button>
                <button class="btn-page" (click)="goToPage(totalPages - 1)" [disabled]="currentPage >= totalPages - 1"
                    title="Trang cu·ªëi">‚è≠</button>
            </div>

            <div class="page-size-selector">
                <label>Hi·ªÉn th·ªã:</label>
                <select [value]="pageSize" (change)="onPageSizeChange($event)">
                    <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}</option>
                </select>
                <span>/ trang</span>
            </div>
        </div>
    </div>
</div>