<div class="ticket-list-container">
    <!-- Page Header -->
    <div class="page-header">
        <div>
            <h1>üé´ Qu·∫£n l√Ω Tickets</h1>
            <p>Theo d√µi v√† x·ª≠ l√Ω c√°c y√™u c·∫ßu nghi·ªáp v·ª•</p>
        </div>
        <div class="header-actions">
            <button class="btn-export pdf" (click)="downloadReport('pdf')" [disabled]="exporting">
                PDF
            </button>
            <button class="btn-export excel" (click)="downloadReport('excel')" [disabled]="exporting">
                Excel
            </button>
            <button class="btn-refresh" (click)="loadTickets()" [disabled]="loading">
                L√†m m·ªõi
            </button>
            <a *ngIf="canCreate()" routerLink="create" class="btn-create">
                + T·∫°o m·ªõi
            </a>
        </div>
    </div>

    <!-- Search Box -->
    <div class="search-box">
        <input type="text" 
               placeholder="T√¨m ki·∫øm theo m√£, ti√™u ƒë·ªÅ, ng∆∞·ªùi t·∫°o..." 
               [value]="searchQuery"
               (input)="onSearch($event)" 
               class="search-input" />
        <span class="search-info">T·ªïng: {{ totalElements }} tickets</span>
    </div>

    <!-- Status Tabs -->
    <div class="status-tabs">
        <button class="status-tab" 
                [class.active]="selectedStatus === 'ALL'"
                (click)="filterStatus('ALL')">T·∫•t c·∫£</button>
        <button class="status-tab" 
                [class.active]="selectedStatus === 'DRAFT'"
                (click)="filterStatus('DRAFT')">B·∫£n nh√°p</button>
        <button class="status-tab" 
                [class.active]="selectedStatus === 'PENDING'"
                (click)="filterStatus('PENDING')">Ch·ªù duy·ªát</button>
        <button class="status-tab" 
                [class.active]="selectedStatus === 'APPROVED'"
                (click)="filterStatus('APPROVED')">ƒê√£ duy·ªát</button>
        <button class="status-tab" 
                [class.active]="selectedStatus === 'REJECTED'"
                (click)="filterStatus('REJECTED')">B·ªã t·ª´ ch·ªëi</button>
    </div>

    <!-- Error Message -->
    <div *ngIf="error" class="error-message">
        {{ error }}
    </div>

    <!-- Loading -->
    <div *ngIf="loading" class="loading">
        <div class="spinner"></div>
        <span>ƒêang t·∫£i...</span>
    </div>

    <!-- Tickets Table -->
    <div *ngIf="!loading" class="table-container">
        <table class="tickets-table">
            <thead>
                <tr>
                    <th>M√£ Ticket</th>
                    <th>Ti√™u ƒë·ªÅ</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>S·ªë ti·ªÅn</th>
                    <th>Ng∆∞·ªùi t·∫°o</th>
                    <th>Ng√†y t·∫°o</th>
                    <th>Thao t√°c</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let ticket of filteredTickets">
                    <td>
                        <strong>{{ ticket.code }}</strong>
                        <br>
                        <small style="color: #9ca3af;">#{{ ticket.id.substring(0,8) }}</small>
                    </td>
                    <td>{{ ticket.title }}</td>
                    <td>
                        <span class="badge" [ngClass]="'badge-' + ticket.status.toLowerCase()">
                            {{ getStatusLabel(ticket.status) }}
                        </span>
                    </td>
                    <td class="amount">
                        {{ ticket.amount | currency:'VND':'symbol':'1.0-0' }}
                    </td>
                    <td>{{ ticket.makerName }}</td>
                    <td>
                        {{ ticket.createdAt | date:'dd/MM/yyyy' }}
                        <br>
                        <small style="color: #9ca3af;">{{ ticket.createdAt | date:'HH:mm' }}</small>
                    </td>
                    <td>
                        <a [routerLink]="[ticket.id]" class="btn-action">Chi ti·∫øt</a>
                    </td>
                </tr>
                <tr *ngIf="filteredTickets.length === 0">
                    <td colspan="7" class="no-data">Kh√¥ng c√≥ d·ªØ li·ªáu</td>
                </tr>
            </tbody>
        </table>

        <!-- Pagination Controls -->
        <div class="pagination-controls" *ngIf="totalPages > 0">
            <div class="pagination-info">
                Hi·ªÉn th·ªã trang {{ currentPage + 1 }} / {{ totalPages }}
            </div>

            <div class="pagination-nav">
                <button class="btn-page" (click)="goToPage(0)" [disabled]="currentPage === 0"
                    title="Trang ƒë·∫ßu">‚èÆ</button>
                <button class="btn-page" (click)="previousPage()" [disabled]="currentPage === 0"
                    title="Trang tr∆∞·ªõc">‚óÄ</button>

                <button *ngFor="let page of getPageNumbers()" class="btn-page" [class.active]="page === currentPage"
                    (click)="goToPage(page)">
                    {{ page + 1 }}
                </button>

                <button class="btn-page" (click)="nextPage()" [disabled]="currentPage >= totalPages - 1"
                    title="Trang sau">‚ñ∂</button>
                <button class="btn-page" (click)="goToPage(totalPages - 1)" [disabled]="currentPage >= totalPages - 1"
                    title="Trang cu·ªëi">‚è≠</button>
            </div>

            <div class="page-size-selector">
                <label>Hi·ªÉn th·ªã:</label>
                <select [value]="pageSize" (change)="onPageSizeChange($event)">
                    <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}</option>
                </select>
                <span>/ trang</span>
            </div>
        </div>
    </div>
</div>

<!-- Export Overlay -->
<div *ngIf="exporting" class="export-overlay">
    <div class="export-card">
        <div class="spinner" style="width: 40px; height: 40px; margin: 0 auto 15px;"></div>
        <div class="export-text">{{ exportMessage }}</div>
        <div class="progress-bar-container">
            <div class="progress-bar" [style.width.%]="exportProgress"></div>
        </div>
    </div>
</div>
