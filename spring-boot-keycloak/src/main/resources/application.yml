server:
  port: 8082
  # Request size limiting (bank-level security)
  max-http-header-size: 8KB
  max-http-post-size: 1MB
  tomcat:
    max-swallow-size: 1MB
    max-connections: 200
    threads:
      max: 200
      min-spare: 10

spring:
  application:
    name: keycloak-integration
  # Request body size limiting
  servlet:
    multipart:
      enabled: true
      max-file-size: 5MB
      max-request-size: 5MB
      file-size-threshold: 1MB
  
  # PostgreSQL DataSource Configuration
  datasource:
    url: jdbc:postgresql://${POSTGRES_HOST:postgres-db}:${POSTGRES_PORT:5432}/${POSTGRES_DB:fis_bank}
    driver-class-name: org.postgresql.Driver
    username: ${POSTGRES_USER:postgres}
    password: ${POSTGRES_PASSWORD}
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
  
  jpa:
    hibernate:
      ddl-auto: update  # Changed from create-drop to update for production
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
        jdbc:
          batch_size: 20
        order_inserts: true
        order_updates: true
  
  # H2 Console (disabled - using PostgreSQL)
  # h2:
  #   console:
  #     enabled: false
  #     path: /h2-console
  
  # Redis Configuration
  redis:
    host: ${REDIS_HOST:redis-cache}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD:}
    timeout: 2000ms
    lettuce:
      pool:
        max-active: 8
        max-idle: 8
        min-idle: 2
        max-wait: -1ms
      shutdown-timeout: 100ms
  
  # Cache Configuration
  cache:
    type: redis
    redis:
      time-to-live: 600000  # 10 minutes in milliseconds
      cache-null-values: false
  
  # Session Configuration with Redis
  session:
    store-type: redis
    timeout: 1800s  # 30 minutes
    redis:
      namespace: spring:session
      flush-mode: on_save

# Keycloak Configuration
keycloak:
  realm: ${KEYCLOAK_REALM:phi-realm}
  auth-server-url: ${KEYCLOAK_AUTH_SERVER_URL:http://keycloak:8080}
  resource: ${KEYCLOAK_RESOURCE:spring-boot-app}

# Security Configuration (Bank-Level)
security:
  ip:
    # IP Whitelisting (chỉ cho phép IP trong danh sách)
    whitelist:
      enabled: false  # Set true để bật whitelist mode
      # Ví dụ: "192.168.1.1,10.0.0.0/8,172.16.0.0/12"
      # Hỗ trợ CIDR notation: "192.168.1.0/24"
      ips: ""  # Danh sách IP được whitelist
    # IP Blacklisting (chặn các IP trong danh sách)
    # Ví dụ: "192.168.1.100,10.0.0.50"
    blacklist: ${SECURITY_IP_BLACKLIST:}
  cors:
    allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:4200}
  csp:
    connect-src: ${CSP_CONNECT_SRC:http://localhost:8082 http://localhost:8080}
  ratelimit:
    ip: ${RATELIMIT_IP:100}
    login: ${RATELIMIT_LOGIN:10}
    user: ${RATELIMIT_USER:20}
    report: ${RATELIMIT_REPORT:60}

# JWT Configuration (Local Token Generation)
jwt:
  secret: ${JWT_SECRET}
  expiration: ${JWT_EXPIRATION:3600000}       # Default 1 hour
  refresh-expiration: ${JWT_REFRESH_EXPIRATION:86400000}  # Default 24 hours

# JasperReports Configuration (External Template from Jaspersoft Studio)
jasperreports:
  template-path: ${JASPER_TEMPLATE_PATH:/home/nguyen-phi/JaspersoftWorkspace/MyReports}
  templates:
    users: Invoice.jrxml
    tickets: tickets_report.jrxml

logging:
  level:
    org.keycloak: DEBUG
    org.springframework.security: DEBUG
    # Audit logging
    AUDIT: INFO

